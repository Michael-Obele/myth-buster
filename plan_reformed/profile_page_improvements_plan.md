# Revised Plan for Profile Page Improvements (Iteration 3)

The objective continues to be transforming the user profile page into a comprehensive dashboard, integrating new data tracking, implementing rate limiting, and preparing for future payment integration, with an added focus on comprehensive historical tracking of user-generated content.

### 1. Data Model Definition (Further Expanded)

We will refine the `UserResearchActivity` model to explicitly capture the type of content generated and its association with a myth, enabling historical tracking.

#### 1.3. Basic User Research Activity (Enhanced Model - `UserResearchActivity`)
This model will now store historical records of various user-generated content, including myth verifications.

*   **`UserResearchActivity` Table/Collection (Revised)**:
    *   `id`: Unique identifier (UUID).
    *   `userId`: Foreign key to the `User` table.
    *   `timestamp`: Timestamp of the activity/content generation. This is crucial for historical tracking.
    *   `researchSessionId`: (Optional) Link to specific research sessions.
    *   `lensUsageMetrics`: JSONB/Map storing counts or duration for each research lens used.
    *   `sourceAnalysisCount`: Integer, total number of source analyses performed.
    *   `synthesisGeneratedCount`: Integer, total number of insight syntheses generated.
    *   `mythTopicFrequency`: JSONB/Map storing frequency of topics researched.
    *   `generatedContentSnippet`: Text, a brief snippet of content generated by the user.
    *   **`contentType`**: String (e.g., 'myth_verification', 'synthesis', 'report_summary', 'research_note'). This helps categorize the historical record.
    *   **`mythId`**: String? (Optional) Foreign key to a `Myth` record, linking the activity to a specific myth if applicable. This is vital for tracking myth verifications.
    *   **`verificationStatus`**: String? (Optional) For `contentType: 'myth_verification'`, this could store the status (e.g., 'verified', 'debunked', 'in_progress').
    *   **`version`**: Int? (Optional) An integer to track versions if a specific piece of content (like a verification) can be explicitly updated, and we want to keep all past versions. If we just add new entries for changes, this might be less critical. For now, we'll rely on new entries for history.

#### Proposed `prisma/schema.prisma` Additions/Updates:
```prisma

model UserResearchActivity {
  id                      String    @id @default(uuid())
  userId                  String
  user                    User      @relation(fields: [userId], references: [id])
  timestamp               DateTime  @default(now())
  researchSessionId       String?
  lensUsageMetrics        Json
  sourceAnalysisCount     Int
  synthesisGeneratedCount Int
  mythTopicFrequency      Json
  generatedContentSnippet String?   @db.Text
  contentType             String    // e.g., 'myth_verification', 'synthesis', 'report_summary'
  mythId                  String?   // Optional: link to a specific Myth record
  verificationStatus      String?   // Optional: e.g., 'verified', 'debunked', 'in_progress'
}

model User {
  id               String             @id @unique
  username         String             @unique
  email            String             @unique
  password_hash    String
  sessions         Session[]
  researchActivities      UserResearchActivity[]
  PremiumAnalytics        PremiumAnalytics[]
}

// Assuming a Myth model exists or will exist:
// model Myth {
//   id          String @id @default(uuid())
//   title       String
//   // ... other myth fields
// }
```

### 2. Profile Page & User Dashboard Enhancements (Updated)

*   **My Research Activity (Enhanced for all users)**:
    *   Display `UserResearchActivity` data in an accessible format, now categorizing by `contentType`.
    *   For `contentType: 'myth_verification'`, show the `mythId`, `verificationStatus`, `generatedContentSnippet`, and `timestamp`. This will form the historical record of verifications.
    *   Allow users to filter or sort their activity history by `contentType`, `mythId`, or date.

### 3. Rate Limiting Implementation

No changes to this section.

### 4. `package.json` Updates (Shortened Commands)

No changes to this section.

### 5. New UI Components & Design Considerations (Improved with `shadcn-svelte`)

No changes to this section, but the display of `UserResearchActivity` will need to account for the new `contentType`, `mythId`, and `verificationStatus` fields.

### 6. Proposed Profile Page Structure (Mermaid Diagram - Unchanged from previous iteration)

```mermaid
graph TD
    A[User Profile Page] --> B{Navigation/Tabs};

    subgraph Tabs
        B -- "Account Details" --> C[Account Details Section];
        B -- "My Research Activity" --> F[My Research Activity Section];
        B -- "Premium Insights (Premium Users)" --> D[Premium Insights Section];
        B -- "Rate Limit & Upgrade" --> G[Rate Limit & Upgrade Section];
        B -- "Settings (Future)" --> E[Settings Section];
    end

    subgraph Account Details Section
        C --> C1[User Profile Card];
        C --> C2[Edit Profile Form];
        C --> C3[Change Password Form];
        C --> C4[Sign Out Button];
    end

    subgraph My Research Activity Section
        F --> F1[Summary of Researched Topics];
        F --> F2[Lenses Used Overview];
        F --> F3[Count of Generated Content];
        F --> F4[List/Preview of Generated Content Snippets (with history)];
    end

    subgraph Premium Insights Section
        D --> D1[Premium Analytics Dashboard];
        D1 -- "Display: Lens Usage, Analysis Count, Sonar Calls" --> D1a[Charts & Graphs];
        D1 -- "Display: Topic Frequency, Research Depth" --> D1b[KPIs & Summary Metrics];
        D --> D2[Myth Insight Summaries];
        D2 -- "List of Recent MythInsights" --> D2a[Insight Cards];
        D2a -- "Details: Reliability Factors, Keywords, Summary" --> D2b[Expandable/Modal View];
        D --> D3[Report Management];
        D3 -- "Button: Generate New Report" --> D3a[Report Generation Flow];
        D3 -- "List of Generated Reports" --> D3b[Download Links];
    end

    subgraph Rate Limit & Upgrade Section
        G --> G1[Current Usage Display];
        G --> G2[Remaining Requests Display];
        G --> G3[Call to Action: Upgrade to Premium (Non-Premium)];
        G --> G4[Promo Key Input Field];
    end

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#eef,stroke:#333,stroke-width:2px
    style C fill:#ccf,stroke:#333,stroke-width:2px
    style D fill:#cfc,stroke:#333,stroke-width:2px
    style E fill:#fff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5
    style F fill:#ADD8E6,stroke:#333,stroke-width:2px
    style G fill:#FFD700,stroke:#333,stroke-width:2px
    style D1 fill:#ffe,stroke:#333,stroke-width:1px
    style D2 fill:#ffe,stroke:#333,stroke-width:1px
    style D3 fill:#ffe,stroke:#333,stroke-width:1px
